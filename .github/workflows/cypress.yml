name: Cypress Tests

on:
  workflow_dispatch:  # Manual trigger only

concurrency:
  group: cypress-tests
  cancel-in-progress: true

jobs:
  test:
    runs-on: ubuntu-latest
    env:
      MY_TOKEN: ${{ secrets.SEC1 }}

    steps:
      - name: Set timezone
        run: |
          export TZ=Asia/Ho_Chi_Minh
          date
          
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Run Cypress tests and capture logs
        run: |
          mkdir -p logs
          echo "üîç Starting Cypress tests..."
          TZ=Asia/Ho_Chi_Minh npx cypress run --spec "cypress/e2e/check.cy.js" | tee logs/output.txt
          echo "‚úÖ Cypress tests complete." | tee -a logs/output.txt

      - name: Upload Cypress log directly
        uses: actions/upload-artifact@v4
        with:
          name: cypress-logs
          path: logs/output.txt

      - name: Delete logs folder
        run: rm -rf logs
